<div class="widget">
    <div class="widget-body"
         style="margin-bottom: 17px;">
        <style type="text/css">
            input[type="number"].parsley-error {
                border-color: #e5e5e5 !important;
                background-color: #f4f7f7 !important;
            }
        </style>
        <div class="row animated fadeIn">
            <div class="col-md-12">
                <div class="panel-title2">Opportunity Cycle</div>
                <div class="col-md-12">
                    <div class="opp-stages">
                        <a ng-repeat="opt in arr_tabs"
                           title="{{opt.name}}"
                           ng-class="{'completed' : opt.stagestatus==1, 'active' : opt.stagestatus==2, 'active-now' : opt.activestagestatus==1,'missed' : opt.stagestatus==4 }"
                           ng-click="set_stage_change(opt.id,stage_record_id);">
                            <span ng-if="opt.stagestatus==1">{{opt.name}}</span>
                            <span ng-if="opt.stagestatus==2">{{opt.name}}</span>
                            <span ng-if="opt.stagestatus==4">{{opt.name}}</span>
                            <span
                                  ng-if="opt.stagestatus!=1 && opt.stagestatus!=2 && opt.stagestatus!=4">{{opt.name}}</span>
                        </a>
                        <input type="hidden"
                               ng-model="rec_oop.stage_id"
                               id="stage_id">
                    </div>
                    <div style="margin-bottom: 18px;">
                        <div class="ib"
                             style="    margin-right: 6px;">
                            <i class="fa fa-circle"
                               style="color: #04a9f4"></i> Active</div>
                        <div class="ib"
                             style="    margin-right: 6px;">
                            <i class="fa fa-circle"
                               style="color: #86bf86"></i> Completed</div>
                        <div class="ib">
                            <i class="fa fa-circle"
                               style="color: #e2a74f"></i> Missed</div>
                    </div>
                </div>
                <div class="col-md-12">

                </div>
                <div class="col-md-5">

                    <div class="form-group">
                        <label class="col-md-4 control-label"> Opp. No.</label>

                        <div class="col-md-8">
                            <input type="text"
                                   class="form-control ng-pristine ng-untouched ng-valid"
                                   ng-model="rec_oop.oop_code"
                                   ng-readonly="product_type || rec_oop.id > 0">
                            <input type="hidden"
                                   ng-model="rec_oop.code_type"
                                   class="ng-pristine ng-untouched ng-valid">
                            <input type="hidden"
                                   ng-model="rec_oop.oop_no"
                                   class="form-control ng-pristine ng-untouched ng-valid">
                        </div>
                    </div>

                    <!--    <div class="form-group">
                              <label class="col-md-4 control-label">Created On</label>
                              <div class="col-md-8">
                              <input type="text" ng-model="rec_oop.date_added" class="form-control" ng-readonly="1" />
                              </div>
                              </div>-->


                    <div class="form-group">
                        <label class="col-md-4 control-label">Name
                            <span class="required">*</span>
                        </label>

                        <div class="col-md-8">
                            <input type="text"
                                   ng-model="rec_oop.name"
                                   id="subject"
                                   class="form-control"
                                   ng-readonly="check_readonly_opp || check_readonly_opp_name || checkReadonlyOppParentName"
                                   required />
                            <input type="hidden"
                                   ng-model="rec_oop.crm_id"
                                   id="crm_no"
                                   class="form-control" />
                            <input type="hidden"
                                   ng-model="rec_oop.id"
                                   id="recUpdateId"
                                   class="form-control" />
                            <input type="hidden"
                                   ng-model="detail.id"
                                   id="detailUpdateId"
                                   class="form-control" />
                            <input type="hidden"
                                   ng-model="stage_id"
                                   id="stage_id"
                                   class="form-control" />
                            <input type="hidden"
                                   ng-model="type"
                                   id="type"
                                   class="form-control" />
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-md-4 control-label">Opp. Approval Process</label>

                        <div class="col-md-8">

                            <ui-select ng-model="rec_oop.process_of_decisions"
                                       ng-change="addNewProcessPopup()"
                                       ng-disabled="check_readonly_opp || check_readonly_opp_name">
                                <ui-select-match placeholder="Select Opp. Approval Process">{{$select.selected.name}}
                                </ui-select-match>
                                <ui-select-choices repeat="opt in arr_process_of_decision | filter: $select.search">
                                    <div ng-bind-html="opt.name | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-md-4 control-label">Contact Person 1 </label>

                        <div class="col-md-4 padr6">
                            <!--  || check_readonly_opp_name -->
                            <ui-select ng-model="rec_oop.contact_person_one"
                                       ng-disabled="check_readonly_opp">
                                <ui-select-match placeholder="Contact Person 1">{{$select.selected.name}}
                                </ui-select-match>
                                <ui-select-choices repeat="opt in arr_alt_contacts | filter: $select.search">
                                    <div ng-bind-html="opt.name | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>

                        <div class="col-md-4 padl6">
                            <ui-select ng-model="rec_oop.role_one"
                                       ng-change="addNewRolePopup(rec_oop.role_one, 1, rec_oop)"
                                       ng-disabled="check_readonly_opp">
                                <ui-select-match placeholder="Select Role 1">{{$select.selected.title}}
                                </ui-select-match>
                                <ui-select-choices repeat="opt in arr_roles1 | filter: $select.search">
                                    <div ng-bind-html="opt.title | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label">Contact Person 2</label>

                        <div class="col-md-4 padr6">
                            <ui-select ng-model="rec_oop.contact_person_two"
                                       ng-disabled="check_readonly_opp">
                                <ui-select-match placeholder="Contact Person 2">{{$select.selected.name}}
                                </ui-select-match>
                                <ui-select-choices repeat="opt in arr_alt_contacts | filter: $select.search">
                                    <div ng-bind-html="opt.name | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>

                        </div>
                        <div class="col-md-4 padl6">
                            <ui-select ng-model="rec_oop.role_two"
                                       ng-change="addNewRolePopup(rec_oop.role_two, 2, rec_oop)"
                                       ng-disabled="check_readonly_opp">
                                <ui-select-match placeholder="Select Role 2">{{$select.selected.title}}
                                </ui-select-match>
                                <ui-select-choices repeat="opt in arr_roles2 | filter: $select.search">
                                    <div ng-bind-html="opt.title | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label">Contact Person 3</label>

                        <div class="col-md-4 padr6">
                            <ui-select ng-model="rec_oop.contact_person_three"
                                       ng-disabled="check_readonly_opp">
                                <ui-select-match placeholder="Contact Person 3">{{$select.selected.name}}
                                </ui-select-match>
                                <ui-select-choices repeat="opt in arr_alt_contacts | filter: $select.search">
                                    <div ng-bind-html="opt.name | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                        <div class="col-md-4 padl6">
                            <ui-select ng-model="rec_oop.role_three"
                                       ng-change="addNewRolePopup(rec_oop.role_three, 3, rec_oop)"
                                       ng-disabled="check_readonly_opp">
                                <ui-select-match placeholder="Select Role 3">{{$select.selected.title}}
                                </ui-select-match>
                                <ui-select-choices repeat="opt in arr_roles3 | filter: $select.search">
                                    <div ng-bind-html="opt.title | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-md-4 control-label"> Forecast Amount
                            <span class="required">*</span>
                        </label>

                        <div class="col-md-4 padr6">
                            <div class="input-symbol">

                                <input type="number"
                                       class="form-control"
                                       ng-readonly="check_readonly_opp"
                                       ng-if="!check_readonly_opp"
                                       ng-model="rec_oop.forecast_amount"
                                       ng-change="validConvrate(rec_oop.forecast_amount, rec_oop.currency_id)" />
                                <!-- data-parsley-trigger="keyup" data-parsley-minlength-message="Invalid Value"
                                     data-parsley-type-message="Invalid Value" required data-parsley-error-message="Invalid Value" pattern="[0-9]+([\.,][0-9]+)*"
                                 -->
                                <!--   data-parsley-pattern="/^(?=.*[1-9])\d{0,25}(?:\.\d{0,25})?$/"-->
                                <!-- <span>{{rec_oop.currency_id.code}}</span> -->
                                <div class="form-control readonlydiv"
                                     ng-if="check_readonly_opp">
                                    {{rec_oop.forecast_amount | currency:""}}
                                </div>

                            </div>
                        </div>
                        <div class="col-md-4 padl6">
                            <ui-select ng-model="rec_oop.currency_id"
                                       ng-change="validConvrate(rec_oop.forecast_amount, rec_oop.currency_id)"
                                       ng-disabled="check_readonly_opp">
                                <ui-select-match placeholder="Select Currency">{{$select.selected.code}}
                                </ui-select-match>
                                <ui-select-choices repeat="opt in arr_currency | filter: $select.search">
                                    <div ng-bind-html="opt.code | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"> Converted Amount</label>

                        <div class="col-md-8">
                            <div class="input-symbol">
                                <div class="form-control readonlydiv">
                                    {{rec_oop.convert_amount | currency:""}}
                                    <!-- data-parsley-trigger="keyup" data-parsley-minlength-message="Invalid Value" data-parsley-type-message="Invalid Value" data-parsley-error-message="Invalid
                                    Value" pattern="[0-9]+([\.,][0-9]+)*" -->
                                    <!--   data-parsley-pattern="/^(?=.*[1-9])\d{0,25}(?:\.\d{0,25})?$/"-->
                                    <!--<span>{{rec_oop.currency_id.code}}</span>-->
                                    <span>{{defaultCurrencyCode}}</span>
                                </div>
                            </div>
                            <!--{{defaultCurrencyCode}}-->
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label">Frequency</label>

                        <div
                             ng-class="{'col-md-6': rec_oop.frequency_id.id==1 || rec_oop.frequency_id.id==2 ,'col-md-8 ' : rec_oop.frequency_id.id!=1 && rec_oop.frequency_id.id!=2}">

                            <select ng-model="rec_oop.frequency_id"
                                    ng-options="opt as opt.title for opt in arrFrequency"
                                    ng-disabled="check_readonly_opp"
                                    class="form-control">
                                <option value=""
                                        disabled
                                        selected>Select Frequency</option>
                            </select>


                        </div>
                        <div class="col-md-2 pl0"
                             style="display: flex;">
                            <!-- ng-class="{'dont-click':check_readonly_opp}" -->
                            <a class="btn-default2 btn"
                               ng-if="rec_oop.frequency_id.id==1 || rec_oop.frequency_id.id==2"
                               ng-click="setFrequencyDetail(rec_oop.frequency_id.id)">
                                <i ng-if="EnableSpread"
                                   style="position: absolute;
                                                           left: -3px;
                                                           background: #ffffff;
                                                           border-radius: 12px;
                                                           padding: 1px 1px;
                                                           border: 1px solid #c5c5c5;
                                                           top: 7px;
                                                           color: gray;"
                                   class="fa fa-check"></i><!--  || check_readonly_opp_name -->
                                Spread
                            </a>
                        </div>
                    </div>
                    <div class="form-group">

                        <!--  {{rec_oop.recfrequeny.january.length}}
                             {{rec_oop.recfrequeny}}  -->
                        <label class="col-md-4 control-label">Created By</label>

                        <div class="col-md-8">
                            <input type="text"
                                   ng-model="defaultUserName"
                                   id="create_by"
                                   class="form-control"
                                   ng-readonly="1" />
                        </div>
                    </div>
                </div>
                <div class="col-md-5 col-md-offset-2">

                    <!-- <div class="form-group">
                        <label class="col-md-4 control-label" ng-class="{'setshow':stage_change == 0}">Stage<span
                                class="required">*</span></label>

                        <div class="col-md-8">

                            <ui-select ng-model="rec_oop.stage_id" ng-disabled="check_readonly_opp && check_readonly_oppStage" ng-change="set_stage_change(rec_oop.stage_id.id,stage_record_id); "
                                required>
                                <ui-select-match placeholder="Select Stage">{{$select.selected.name}}</ui-select-match>
                                <ui-select-choices repeat="opt in arr_tabs | filter: $select.search">
                                    <div ng-bind-html="opt.name | highlight: $select.search"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>
                    </div> -->

                    <div class="form-group"
                         ng-if="rec_oop.stage_id.start_end == 2">
                        <label class="col-md-4 control-label"> Outcome </label>

                        <div class="col-md-8">
                            <select ng-model="rec_oop.final_step"
                                    ng-options="opt as opt.name for opt in arr_tabspostion"
                                    ng-disabled="check_readonly_opp"
                                    ng-change="OnChangeOutComeLastStage();"
                                    class="form-control">
                                <option value=""
                                        disabled
                                        selected>Select</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group"
                         ng-if="rec_oop.stage_id.start_end != 2 || (rec_oop.stage_id.start_end == 2 && rec_oop.final_step.id > 0)">
                        <label class="col-md-4 control-label">Probability <span class="required">*</span></label>

                        <div class="col-md-8">
                            <div class="input-symbol">
                                <input type="text"
                                       required
                                       ng-model="detail.probability"
                                       class="form-control"
                                       ng-disabled="check_readonly_opp || rec_oop.stage_id.start_end == 2"
                                       data-parsley-trigger="keyup"
                                       data-parsley-minlength-message="Invalid Value"
                                       data-parsley-type-message="Invalid Value"
                                       min="0"
                                       max="100"
                                       data-parsley-error-message="Invalid Value"
                                       data-parsley-pattern="/^(?=.*[0-9])\d{0,25}(?:\.\d{0,25})?$/"
                                       ng-change="set_percentage(detail.probability, rec_oop.stage_id, rec_oop.stage_id.start_end)"
                                       ng-readonly="oop_cycle_edit_role == 0" />
                                <span>
                                    <!--{{rec_oop.stage_id.percentage}}  -->&#37;</span>
                                <!--{{oop_cycle_edit_role}}-->
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"> Stage Start Date </label>

                        <div class="col-md-8">
                            <input ng-if="!checkReadonlyOppParentName"
                                   class="form-control"
                                   placeholder="dd/mm/yyyy"
                                   ng-model="detail.start_date"
                                   ng-disabled="check_readonly_opp"
                                   ng-class="{'pickdate':!check_readonly_opp}"
                                   readonly>

                            <input jqdatepicker
                                   ng-if="checkReadonlyOppParentName"
                                   class="form-control"
                                   placeholder="dd/mm/yyyy"
                                   ng-model="detail.start_date"
                                   ng-disabled="check_readonly_opp"
                                   ng-class="{'pickdate':!check_readonly_opp}"
                                   readonly>
                            <span class="fa fa-calendar  new_ca  form-control-feedback"
                                  aria-hidden="true"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"
                               ng-if="rec_oop.is_complete != 1"> Estimated Stage End Date </label>
                        <label class="col-md-4 control-label"
                               ng-if="rec_oop.is_complete == 1"> Completed Stage End Date </label>

                        <div class="col-md-8">
                            <input jqdatepicker
                                   class="form-control"
                                   placeholder="dd/mm/yyyy"
                                   ng-model="detail.end_date"
                                   ng-disabled="check_readonly_opp"
                                   ng-class="{'pickdate':!check_readonly_opp}"
                                   readonly>
                            <!-- -->
                            <span class="fa fa-calendar  new_ca  form-control-feedback"
                                  aria-hidden="true"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label">Expected Deal Close Date </label>

                        <div class="col-md-8">
                            <input jqdatepicker
                                   class="2date-picker form-control"
                                   placeholder="dd/mm/yyyy"
                                   ng-model="detail.expected_close_date"
                                   ng-disabled="check_readonly_opp"
                                   readonly
                                   ng-class="{'pickdate':!check_readonly_opp}">
                            <span class="fa fa-calendar  new_ca  form-control-feedback"
                                  aria-hidden="true"></span>
                        </div>
                    </div>
                    <div class="form-group"
                         ng-show="tab.name == 'Outcome'">
                        <label class="col-md-4 control-label">Outcome</label>

                        <div class="col-md-8">
                            <select ng-model="rec_oop.win_lost_outcome"
                                    ng-options="opt as opt.name for opt in arr_win_lost_outcome"
                                    ng-disabled="check_readonly_opp"
                                    class="form-control">
                                <option value=""
                                        disabled
                                        selected>Select</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label">Salesperson </label>

                        <div class="col-md-8  ">
                            <div class="panel-info pi2"
                                 ng-class="{'dont-click readonly':check_readonly_opp,'max-height':selectedSpOopCycle.length>5}">
                                <!-- <div class="panel-body" ng-click="getSalePersonsOopCycle()" tabindex="0"  ng-keypress="handleKeyPress($event,1)">
                                    <span ng-repeat="sp in selectedSpOopCycle track by $index">
                                        <span ng-if="sp.isPrimary">
                                            <span ng-class="{'hilight':sp.isPrimary}">{{sp.name}};</span>
                                        </span>
                                    </span>
                                    <span ng-repeat="sp in selectedSpOopCycle track by $index">
                                        <span ng-if="!sp.isPrimary">
                                            <span>{{sp.name}};</span>
                                        </span>
                                    </span>
                                    <aside></aside>
                                </div> -->
                                <div class="panel-body"
                                     ng-click="getSalePersonsOopCycle()"
                                     tabindex="0"
                                     ng-keypress="handleKeyPress($event,1)">
                                    <span ng-repeat="sp in selectedSpOopCycle track by $index">
                                        <span ng-if="sp.isPrimary">
                                            <span ng-class="{'text-primary':sp.isPrimary}">{{sp.name}}</span>
                                        </span>
                                    </span>
                                    <span ng-repeat="sp in selectedSpOopCycle track by $index">
                                        <span ng-if="!sp.isPrimary">
                                            <span ng-if="selectedSpOopCycle.length == 1">{{sp.name}}</span>
                                            <span ng-if="selectedSpOopCycle.length > 1">{{sp.name}}
                                                <span
                                                      ng-if="$index < selectedSpOopCycle.length && $index!=0">;&nbsp;</span></span>
                                        </span>
                                    </span>
                                    <aside></aside>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-md-4 control-label">Support Staff
                            <!-- <small class="info">if applicable</small> -->
                        </label>

                        <div class="col-md-8  ">
                            <div class="panel-info pi2"
                                 ng-class="{'dont-click readonly':check_readonly_opp,'max-height':selectedsupportstaff.length>5}">
                                <!-- <div class="panel-body" ng-click="getSupportStaffOopCycle()" tabindex="0" ng-keypress="handleKeyPress($event,2)">
                                    <span ng-repeat="sp in selectedsupportstaff track by $index">
                                        <span ng-if="$index == 0">
                                            <span ng-class="{'hilight':sp.isPrimary}">{{sp.name}}</span>
                                        </span>
                                        <span ng-if="$index > 0">;&nbsp;
                                            <span ng-class="{'hilight':sp.isPrimary}">{{sp.name}}</span>
                                        </span>
                                    </span>
                                    <aside></aside>
                                </div> -->
                                <div class="panel-body"
                                     ng-click="getSupportStaffOopCycle()"
                                     tabindex="0"
                                     ng-keypress="handleKeyPress($event,2)">
                                    <span ng-repeat="sp in selectedsupportstaff track by $index">
                                        <span ng-if="sp.isPrimary">
                                            <span ng-class="{'hilight':sp.isPrimary}">{{sp.name}};</span>
                                        </span>
                                    </span>
                                    <span ng-repeat="sp in selectedsupportstaff track by $index">
                                        <span ng-if="!sp.isPrimary">
                                            <span ng-if="selectedsupportstaff.length == 1">{{sp.name}}</span>
                                            <span ng-if="selectedsupportstaff.length > 1">{{sp.name}}<span
                                                      ng-if="$index < selectedsupportstaff.length && $index!=0">;&nbsp;</span></span>
                                        </span>
                                    </span>
                                    <aside></aside>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label">Opportunity Notes</label>

                        <div class="col-md-8">
                            <textarea name="notes"
                                      cols="160"
                                      rows="4"
                                      id="note"
                                      ng-model="rec_oop.notes"
                                      class="form-control"
                                      ng-readonly="check_readonly_opp"
                                      maxlength="500"
                                      style="resize:none;"></textarea>
                            <!--<span class="word-counter">   {{rec_oop.notes.length}}/500   </span>-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-12">
                    <div class="pull-right">
                        <!-- <attachment-upload ng-if="rec_oop.id > 0" x-type="1" x-sub-type="1" x-sub-type-id="rec_oop.id" x-type-id="$stateParams.id">
                        </attachment-upload> -->
                        <!-- <div ng-if="rec_oop.id > 0" ng-controller="fileUploadController" ng-init="fileData = {type:1,subType:1,subTypeID:rec_oop.id, typeID:$stateParams.id};"
                            class="fileUpload btn btn-default2 pull-right">
                            <span> Upload Attachment(s)</span>
                            <input type="file" ngf-select="onFileSelect($files, $invalidFiles, fileData)" name="file" multiple="" class="upload" accept=".xlsx, .xls, .ppt, .pptx, .doc, .docx, .pdf,.txt,.jpg,.jpeg,.png,.gif,.tiff,.zip"
                                ngf-max-size="5MB">
                        </div> -->
                    </div>
                    <div class="pull-right"
                         ng-if="rec_oop.is_complete != 1">
                        <!--ng-hide="rec_oop.is_complete == 1"-->
                        <!--   <button type="button" class="btn btn-default2"
                                    ng-show="rec_oop.id > 0 && crm_oop_cycle_tab_module > 0" title="Show Previous Tabs"
                                    ng-click="showPreviousTabs(rec_oop.id)">
                                    <i class="fa fa-eye"></i></button>-->

                        <div class="dropdown ib"
                             ng-show="rec_oop.id > 0 && crm_oop_cycle_tab_module > 0">
                            <button class="dte-btn dropdown-toggle"
                                    type="button"
                                    data-toggle="dropdown">
                                <i class="dte-ico"></i>
                            </button>
                            <ul class="dropdown-menu dte animated fadeIn">
                                <!--<span ng-click="set_document_internal(crm_oop_cycle_tab_module)">
                                                <i class="fa fa-file-text-o" aria-hidden="true"></i> Add Document</span>-->
                                <span ng-click="getDocuments_opp(crm_oop_cycle_tab_module,rec_oop.stage_id.id)">
                                    <i class="fa fa-file-text-o"
                                       aria-hidden="true"></i> Add Document</span>
                                <span>
                                    <i class="fa fa-check"
                                       aria-hidden="true"></i> Add Task</span>
                                <span>
                                    <i class="fa fa-envelope-o"
                                       aria-hidden="true"></i> Compose Email</span>
                            </ul>
                        </div>
                        <!--  <button type="submit" class="btn btn-default2" ng-if=" rec_oop.id > 0" ng-click="isComplete(rec_oop.stage_id.id)">
                                    <i class="fa fa-check fa_display"></i>Complete Stage</button>-->

                        <!-- <button class="btn btn-default2" type="button" ng-show="rec_oop.id > 0" ng-click="add_to_pipeline(rec, detail, rec_oop.stage_id.id)"><i
                                class="fa fa-check fa_display"></i> Add To Pipeline
                        </button> -->
                        <button type="button"
                                class="btn btn-default2"
                                id="completeStage"
                                ng-class="{'dont-click setshow6':(stage_record_id == 0 || rec_oop.is_complete == 1 || checkCompleteOpp==0) }"
                                ng-click="isComplete(rec_oop.stage_id.id, stage_record_id, rec_oop.stage_id.start_end)">
                            <i class="fa fa-check"></i> Complete Stage
                        </button>

                        <button class="btn btn-edit"
                                type="button"
                                ng-click="showOppCycleEditForm()"
                                ng-if="check_readonly_opp && editOppCyclePermission && !allStagesCompleted">
                            <i class="fa fa-edit fa_display"></i> Edit
                        </button>
                        <button class="btn btn-delete"
                                type="button"
                                ng-click="delete_oop(stage_record_id)"
                                ng-if="stage_record_id > 0 && !check_readonly_opp && deleteOppCyclePermission && !(tabsDetil.length>0)">Delete
                        </button>
                        <button class="btn btn-submit"
                                type="submit"
                                ng-if="!check_readonly_opp && !allStagesCompleted">
                            <i class="fa fa-check fa_display"></i> Save
                        </button>
                        <button class="btn btn-cancel2"
                                type="button"
                                ng-click="getOpportunityCycle()">
                            <i class="fa fa-undo fa_display"></i> Cancel
                        </button>
                    </div>
                    <div class="pull-right"
                         ng-if="rec_oop.is_complete == 1">
                        <!-- <button class="btn btn-edit" type="button" ng-click="showOppCyclestageactiveForm()" ng-if="check_readonly_oppStageedit_btn"><i class="fa fa-edit fa_display"></i> Edit
                        </button> -->
                        <button class="btn btn-cancel2"
                                type="button"
                                ng-click="getOpportunityCycle()">
                            <i class="fa fa-undo fa_display"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div ng-include="'app/views/crm/_salesperson_popup_oop.html'"></div>
<div ng-include="'app/views/crm/_salesperson_popupstaff_oop.html'"></div>
<div ng-include="'app/views/crm/opp_internal_document.html'"></div>

<div class="row"
     ng-if="tabsDetil.length > 0">
    <div class="col-md-3">
        <div class="input-symbol">
            <input type="text"
                   ng-model="Serachkeywordoophistory"
                   placeholder="Search"
                   class="in-t-1" />
            <span id="date_msg_4">
                <i class="fa fa-search"></i>
            </span>
        </div>
    </div>
    <div class="col-md-9">
    </div>
    <div class="col-md-12">
        <div class="widget">
            <div class="widget-body "
                 style="margin-top:15px;">
                <div id="dt_example"
                     class="example_alt_pagination">
                    <div class="panel-title2"
                         style="padding: 0 !important;margin: 0 0 14px 0;">
                        Opp Cycle Stage History
                    </div>
                    <div class="table-responsive">
                        <table class="table table-condensed table-striped table-hover table-bordered"
                               id="data-table">
                            <thead>
                                <tr class="bg-col">
                                    <th>Stage</th>
                                    <th>Name</th>
                                    <th class="text-right">Forecast Amount</th>
                                    <th>Start Date</th>
                                    <th>Completion Date</th>
                                    <th class="text-right">Probability</th>
                                    <!-- <th>User ID</th> -->
                                    <th style="    width: 21%;">Notes</th>
                                </tr>
                            </thead>
                            <tbody class=" table-body">
                                <!-- gl in gl_account | limitedFilter:filterGL.search:['code','name'] -->
                                <tr
                                    ng-repeat="recordhis in tabsDetil| limitedFilter:Serachkeywordoophistory:['stageNumber', 'stagename', 'forecast_amount', 'start_date', 'end_date', 'percentage_stage', 'notes']"><!-- probability -->
                                    <td ng-click="editForm_oop_detail(recordhis)"> {{recordhis.stageNumber}} </td>
                                    <td ng-click="editForm_oop_detail(recordhis)"> {{recordhis.stagename}}</td>
                                    <td ng-click="editForm_oop_detail(recordhis)"
                                        class="text-right"> {{recordhis.forecast_amount | currency:""}}</td>
                                    <td ng-click="editForm_oop_detail(recordhis)"> {{recordhis.start_date}}</td>
                                    <td ng-click="editForm_oop_detail(recordhis)"> {{recordhis.end_date}}</td>
                                    <!-- date_added -->
                                    <td ng-click="editForm_oop_detail(recordhis)"
                                        class="text-right"> {{recordhis.percentage_stage}}%</td><!-- probability -->
                                    <!-- <td ng-click="editForm_oop_detail(recordhis)"> {{currentUser| capitalize }}</td> -->
                                    <td class="full-notes">
                                        <a tabindex="0"
                                           role="button"
                                           class="half-note"
                                           data-toggle="popover"
                                           title="{{recordhis.stagename}} Notes"
                                           data-content=" {{recordhis.notes}}"
                                           data-placement="left"
                                           data-trigger="hover"
                                           style="    white-space: nowrap;
                                            text-overflow: ellipsis;
                                            display: block;
                                            overflow: hidden;">
                                            {{recordhis.notes}}
                                        </a>
                                    </td>
                                    <script>
                                        $(document).ready(function () {
                                            $('[data-toggle="popover"]').popover();
                                        });
                                    </script>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>