<div ng-class="{'whirl no-overlay':showLoader || generatePdf.showLoader}"></div>
<div style="margin-bottom: 13px;">
    <div class="row" style="margin-bottom: 7px !important;">
        <div class="col-md-3">
            <button type="button" class="btn btn-default2" style="    color: #2196F3;margin-left: 0;" ng-click="selectItem(0, 1,rec)" ng-if="rec.type == 1 && submit_show_invoicee" ng-disabled="show_recieve_list || check_sr_readonly || !(rec.supplierNo.length>0)">Select
                Item</button>
            <button class="btn btn-default2" type="button" style="    color: #2196F3;" ng-click="selectItem(1, 1,rec)" ng-if="rec.type == 1 && submit_show_invoicee" ng-disabled="check_sr_readonly || !(rec.supplierNo.length>0)">Select
                G/L</button>
            <!-- show_recieve_list ||  -->
        </div>

    </div>

    <table class="table table-striped table-bordered no-readonly">
        <thead class="fixit">
            <tr>
                <th style="width: 44px;">Type</th>
                <th style="width: 75px;">No.</th>
                <th style="width:180px">Description</th>
                <!--width:220px  -->
                <th class="text-right">Qty.</th>
                <th style="width:62px">U.O.M</th>
                <th style="width:10% ">Warehouse</th>
                <!-- width:17%-->
                <th class="text-right">Unit Price</th>
                <th style="width: 7%;">Discount Type</th>
                <th class="text-right">Discount</th>
                <th>VAT Rate</th>
                <th class="text-right">Original<br />Amount</th>
                <th class="text-right">Discount<br />Amount</th>
                <th class="text-right"> Total<br /> Amount </th>
                <th class="text-right">VAT</th>
                <th style="width: 60px;">Action</th>
            </tr>
        </thead>
        <tbody class="fixit" style="max-height: 229px;">
            <tr ng-class="{'t-partiallyallocated' : item.purchase_status == 0 && item.remainig_qty > 0  && item.remainig_qty !=item.qty, 
                                't-allocatedstock': item.purchase_status !=2 && item.remainig_qty == 0 ,
                                't-stockreceived' : item.purchase_status == 2 && item.item_type == 0}" ng-repeat="(key,item) in items">
                <td style=" width: 44px;" ng-if="item.item_type == 0">
                    <select disabled="disabled" class="form-control" style="background: none; border: 0;padding: 0;">
                        <option>Item</option>
                    </select>
                </td>
                <td style=" width: 44px;" ng-if="item.item_type == 1">
                    <select disabled="disabled" class="form-control" style="background: none;border: 0;padding: 0;">
                        <option>G/L</option>
                    </select>
                </td>
                <td style=" width: 44px;" ng-if="item.item_type == 2">
                    <select disabled="disabled" class="form-control">
                        <option>Service</option>
                    </select>
                </td>
                <td ng-if="item.item_type == 0 || item.item_type == 1" style=" width: 75px;" title="{{item.product_code}}">{{item.product_code}}
                    <a title="Landing Cost Setup" class="tooltips_clsss btn " ng-if="item.total_landing_cost>0" ng-click="show_landing_cost_detail(item.supplier_id,item.id)">
                        <i class="fa fa-eye"></i>
                    </a>
                </td>
                <td ng-if="item.item_type == 2" style=" width: 75px;" title="{{item.code}}">{{item.code}}
                </td>
                <td style="width:180px" title="{{item.product_name}}">
                    <input type="text" class="form-control input_text" ng-model="item.product_name" ng-readonly="check_sr_readonly">
                </td>
                <!-- width:220px -->
                <td class="text-right">
                    <input class="form-control input_text text-right" type="number" ng-if="!check_srm_readonly" style="color:black" ng-readonly="check_sr_readonly || (item.purchase_status>1 && item.item_type != 1)" ng-change=" !check_sr_readonly && check_min_max(item)" ng-blur="!check_srm_readonly && UpdateQty(item)"
                        ng-model="item.qty" min="0" oninput="validity.valid||(value='');" step="any" data-parsley-trigger="keyup" data-parsley-minlength-message="Invalid Value" data-parsley-type-message="Invalid Value" data-parsley-error-message="Invalid Value"
                        data-parsley-pattern="/^(?=.*[1-9])\d{0,25}(?:\.\d{0,25})?$/">

                    <span ng-if="check_srm_readonly">{{item.qty | numberNoDecimalsIfZeroFilter:2:''}}</span>
                </td>
                <td style="    width: 62px;">
                    <!-- show_recieve_list -->
                    <select class="form-control" ng-if="item.item_type == 0" ng-model="item.units" ng-change="!check_sr_readonly && check_min_max(item)" ng-options="opt as opt.name for opt in item.arr_units" ng-disabled="item.item_type == 0 || show_recieve_list  || check_sr_readonly">
                        <option style="display:none"
                                value=""></option><!-- +'('+opt.quantity+')' -->
                    </select>
                    <select class="form-control" ng-model="item.units" ng-if="item.item_type == 1" ng-options="opt as opt.title for opt in gl_arr_units" ng-disabled="check_sr_readonly">
                        <option value=""></option><!-- style="display:none" -->
                    </select>
                    <!-- required -->
                    <select class="form-control" disabled ng-if=" item.item_type == 2" ng-model="item.units" ng-options="opt as opt.title for opt in service_arr_units">
                        <option style="display:none"
                                value=""></option>
                    </select>
                </td>
                <!--width:17% -->
                <td style="width:10%" ng-if="item.item_type == 0">
                    <!-- <select class="form-control"
                            ng-attr-title="{{item.warehouse_name_qty}}"
                            ng-disabled="check_sr_readonly"
                            ng-change="checkDuplWHItem(item, $index)"
                            ng-model="item.warehouses">
                        <option ng-repeat="opt in item.arr_warehouse"
                                ng-disabled="opt.disabled"
                                ng-selected="{{opt.id == item.warehouses}}"
                                value="{{opt.id}}"> {{opt.name}} ({{opt.available_quantity}}) </option>
                    </select> -->
                    <select class="form-control " title="{{item.warehouses.name}} ({{item.warehouses.available_quantity}})" ng-disabled="(item.remainig_qty < item.qty && item.stock_check>0) || check_sr_readonly " ng-if="!check_sr_readonly" ng-model="item.warehouses" ng-options="opt as opt.name +' ('+opt.available_quantity+')' for opt in item.arr_warehouse">
                        <option style="display:none"
                                value=""></option>
                    </select>

                    <span style="white-space: nowrap;" title="{{item.warehouses.name}} ({{item.warehouses.available_quantity}})" ng-if="check_sr_readonly && item.warehouses">{{item.warehouses.name}}
                        ({{item.warehouses.available_quantity}})</span>
                </td>
                <td style=" width:10%" ng-if="item.item_type == 2">&nbsp</td>
                <!--width:17%  -->
                <td style="width:10%" ng-if="item.item_type == 1">&nbsp</td>
                <!-- width:17% -->
                <td class="text-right">

                    <div>
                        <!-- <x-expression-eval ng-model="item.standard_price"
                                           step="any"
                                           ng-if="!check_sr_readonly && item.item_type == 0"
                                           id="standard_price"
                                           x-value='item.standard_price'
                                           enable-percentage='1'
                                           title="Add expression * + - () / % and press tab to recalculate Unit Price"
                                           ng-blur="ValidateItemPrice(item)">
                        </x-expression-eval>

                        <x-expression-eval ng-model="item.standard_price"
                                           step="any"
                                           ng-if="!check_sr_readonly && item.item_type != 0"
                                           id="standard_price"
                                           x-value='item.standard_price'
                                           enable-percentage='1'
                                           title="Add expression * + - () / % and press tab to recalculate Unit Price"
                                           ng-blur="ValidateItemPrice(item)">
                        </x-expression-eval> -->

                        <input type="text" class="form-control input_text text-right" oninput="validateDecimalPoints(this, 5)" ng-readonly="check_sr_readonly" ng-model="item.standard_price" ng-blur="!check_sr_readonly && ValidateItemPrice(item)" ng-if="!check_sr_readonly">

                        <span ng-if="check_sr_readonly" ng-disabled="check_sr_readonly" class="form-control" title="{{item.standard_price | unitPriceFilter}}">{{item.standard_price | unitPriceFilter}}</span>

                    </div>
                    <!-- show_recieve_list  ||  -->
                </td>
                <td style="width: 7%;">
                    <select class="form-control" ng-disabled="check_sr_readonly" ng-model="item.discount_type_id" ng-change="onChangeDiscountType(item);" ng-options="opt as opt.name for opt in arr_discount_type">
                        <option style="display:none"
                                value=""></option>
                    </select>
                </td>
                <td class="text-right">
                    <div class="input-symbol">
                        <input type="number" step="0.01" style="color:black" class="form-control input_text  text-right" ng-readonly="check_sr_readonly" ng-change="onChangeDiscountType(item);" ng-pattern="/^[0-9]+(\.[0-9]{1,9})?$/" ng-model="item.discount" ng-if="!check_sr_readonly">
                    </div>
                    <span ng-show="item.discount_type_id.id == 'Percentage' && check_sr_readonly">{{item.discount}}&#37;</span>
                    <span ng-show="item.discount_type_id.id != 'Percentage' && check_sr_readonly">{{item.discount}}</span>
                </td>
                <td title="{{item.vats.name}}">
                    <select class="form-control" ng-disabled="check_sr_readonly" ng-model="item.vats" ng-if="item.isGLVat!=true" ng-options="opt as opt.name for opt in arrVATPostGrpPurchase">
                        <option style="display:none"
                                value=""></option>
                    </select>
                    <!-- arr_vat_post_grp[order_posting_group_id] -->
                </td>

                <td class="text-right" title="{{(item.isGLVat==true) ? 0 :item.standard_price * item.qty | currency:''}}">
                    {{(item.isGLVat==true) ? 0 :item.standard_price * item.qty | currency:""}}</td>
                <td class="text-right" title="{{rowDiscount(item)  | currency:'' }} "> {{rowDiscount(item) | currency:"" }} </td>
                <td class="text-right" title="{{item.total_price = rowTotal(item) | currency:''}}">{{item.total_price = rowTotal(item) | currency:""}}
                </td>
                <td class="text-right" title=" {{item.vatPrice = rowVat(item) | currency:''}}"> {{item.vatPrice = rowVat(item) | currency:""}}
                </td>
                <td style="    width: 60px;padding-right: 15px;padding-left: 2px;">
                    <span ng-if="item.item_type == 0">
                        <a title="{{ item.purchase_status == 1 ? 'Stock Allocation Completed' : 'Deallocate Stock'}}"
                           ng-if="item.stock_check == 1 && rec.supplierNo.length>0"
                           ng-click="allocateStock(item,rec,$index)   "
                           ng-class="{'dont-click':!show_recieve_list_anchor}">
                            <i class="fa fa-cubes"
                               ng-class="{'in-comp-alloc' : item.purchase_status == 1 && item.remainig_qty > 0  && item.remainig_qty !=item.qty, 
                                'comp-alloc': !show_recieve_list && item.remainig_qty == 0 ,
                                'item-dispatch' : show_recieve_list}"></i>
                        </a>
                    </span>
                    <a title="Delete" ng-click="deleteOrderLine($index, item, items)" style="float: right;margin-right: 3px;" ng-class="{'dont-click':!show_recieve_list_anchor || check_sr_readonly}">
                        <i class="fa fa-times"></i>
                    </a>
                </td>
            </tr>
            <tr ng-show="items.length ==0 ">
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td><input type="text" value="" readonly="readonly" class="form-control col-md" style="color:black"></td>
                <td><input type="text" value="" readonly="readonly" class="form-control col-md" style="color:black"></td>
                <td><input type="text" value="" readonly="readonly" class="form-control col-md" style="color:black"></td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
        </tbody>
    </table>
</div>

<div ng-class="{'col-md-7': (showVolumeWeight>0 && itemExists), 'col-md-9': !(showVolumeWeight>0 && itemExists)}" style="padding-left: 0;">
    <textarea rows="4" cols="30" maxlength="500" placeholder="Add Note" class="form-control ng-pristine ng-valid ng-binding ng-valid-maxlength ng-touched" ng-model="rec.note" style="resize: none;height: 90px !important;    margin-bottom: 10px; color: red;"
        ng-change="showWordsLimits_invoice()" ng-disabled="check_sr_readonly && !check_pi_readonly">
    </textarea>
    <span class="word-counter">{{wordsLength}}/500</span>
</div>
<div class="col-md-2 no-padding" id="total-amout" ng-if="showVolumeWeight>0 && itemExists">
    <table class="invoice_total">
        <tr ng-if="volume !=0 && volume_permission>0">
            <td class="text-left">Total Volume</td>
            <td class="text-right">{{volume | quantityNum:2:''}} <span ng-if="volume_unit == 'cm3'">cm&sup3;</span><span ng-if="volume_unit != 'cm3'">{{volume_unit}}</span></td>
        </tr>
        <tr ng-if="weight !=0 && weight_permission>0">
            <td class="text-left">Total Weight</td>
            <td class="text-right">{{weight | quantityNum:2:''}} {{weightunit}}</td>
        </tr>
    </table>
    <div>
    </div>
    <div class="clearfix">&nbsp;</div>
</div>
<div class="col-sm-3 no-padding" id="total-amout">
    <div class="invoice_items-total no-margin">
        <table class="invoice_total">
            <tr ng-if="calcDiscount()>0">
                <td class="text-right">Discount</td>
                <td class="text-right">{{calcDiscount() | currency:""}}&nbsp;{{rec.currency_id.code}}</td>
            </tr>
            <tr>
                <td class="text-right">Amount</td>
                <td class="text-right"> {{netTotal() | currency:""}}&nbsp;{{rec.currency_id.code}}</td>
            </tr>
            <tr>
                <td class="text-right">VAT</td>
                <td class="text-right">{{calcVat() | currency:""}}&nbsp;{{rec.currency_id.code}}</td>
            </tr>
            <tr>
                <td class="text-right">Amount Incl. VAT</td>
                <td class="text-right">{{grandTotal() | currency:""}}&nbsp;{{rec.currency_id.code}}</td>
            </tr>
        </table>
    </div>
</div>

<div class="row">
    <div class="col-md-12" style="margin-top: 13px;">
        <div class="pull-left" id="curent">
            <!-- <div id="curent_2"> -->
            <div>
                <span class="margin-right">
                        <i class="fa fa-circle"
                           style="color:#ef7372;"></i> Partially Allocated </span>
                <span class="margin-right">
                        <i class="fa fa-circle"
                           style="color:#25b726;"></i> Allocated Stock </span>
                <span class="margin-right">
                        <i class="fa fa-circle "
                           style="color:#ffd351;"></i> Stock Recieved</span>
            </div>

            <!-- <div class="communication">

                <sidebar-notes ng-if="noRoleAssigned !=1" class="noselect"></sidebar-notes>
                <sidebar-email ng-if="noRoleAssigned !=1" class="noselect"></sidebar-email>
                <sidebar-attachment ng-if="noRoleAssigned !=1" class="noselect"></sidebar-attachment>
            </div> -->
            <!-- </div> -->
        </div>

        <div class="pull-right" ng-if="(rec.type == 1) && submit_show_invoicee">

            <emailer ng-if="rec.debitNoteCode && items.length > 0 && check_sr_readonly == true" x-hide-button="true" x-page-name="Purchases_DebitNotes" x-parent-record-id="rec.id" x-parent-record-name="{{rec.debitNoteCode}} - {{rec.supplierName}}" x-to="supplierDebitEmail"
                x-to-array="rec.supplier_emails.Emails" x-record-against="Supplier" x-modal-title="{{rec.debitNoteCode}}" x-pdf-generator="showInvoiceModal('debitNote', 1)" x-button-title="Debit Note" x-data-obj="rec" x-html-destroy="debit_note_modal" x-pdf-ready="serviceVariables.generatedPDF">
            </emailer>
            <!--  && rec.payable_bank -->

            <button class="btn btn-default" type="button" ng-click="showInvoiceModal('debitNote')" ng-show="rec.debitNoteCode && items.length > 0 && check_sr_readonly == true">Debit
                Note</button>
            <!--  && rec.payable_bank -->

            <button class="btn btn-default" type="button" ng-click="convert_post_invoice(rec,rec2)" ng-disabled="!check_sr_readonly  || disablePostInvBtn" ng-if="items.length > 0 && allowpost_prucase_order_return" ng-readonly="show_invoice">
                <i class="fa fa-check fa_display"></i>Post Debit Note
            </button>

            <button class="btn btn-default " type="button" ng-click="allocation_saved(rec,rec2)" ng-if="items.length > 0 && !show_recieve_list && itemExists && allowdispatch_prucase_order_return" ng-readonly="show_stock" ng-disabled="!check_sr_readonly  || disablePostInvBtn || disableReceiveBtn"
                ng-class="">
                <i class="fa fa-check fa_display"></i>Dispatch Stock
            </button>
            <button class="btn btn-default stockDispatchedBtn dont-click" type="button" ng-if="items.length > 0 && show_recieve_list && itemExists" ng-readonly="show_stock">
                <i class="fa fa-check fa_display"></i> Stock Dispatched
            </button>
            <button class="btn pic_block btn-submit uom_check" type="button" ng-click="add_sublist(rec,rec2)" ng-show="!check_sr_readonly">
                <i class="fa fa-check fa_display"></i> Save
            </button>
            <button class="btn btn-edit" type="button" ng-click="showEditForm();showEditorderForm()" ng-show="check_sr_readonly" ng-if="allowedit_prucase_order_return">
                <i class="fa fa-edit fa_display"></i> Edit
            </button>
            <button class="btn btn-cancel" type="button" ui-sref="{{btnCancelUrl}}" ng-if="!debitNoteDeleteBtn"><i class="fa fa-undo fa_display"></i>Cancel
            </button>
            <button class="btn btn-cancel" type="button" ng-click="discardDebitNote()" ng-if="debitNoteDeleteBtn"><i class="fa fa-undo fa_display"></i>Cancel</button>
        </div>
        <div class="pull-right" ng-show="!(rec.type == 1)">

            <emailer ng-if="rec.invoice_code" x-hide-button="true" x-page-name="Purchases_PostedDebitNotes" x-parent-record-id="rec.id" x-parent-record-name="{{rec.invoice_code}} - {{rec.supplierName}}" x-to="supplierDebitEmail" x-to-array="rec.supplier_emails.Emails"
                x-record-against="Supplier" x-modal-title="{{rec.invoice_code}}" x-pdf-generator="showInvoiceModal('postedDebitNote', 1)" x-button-title="Posted Debit Note" x-data-obj="rec" x-html-destroy="debit_note_modal" x-pdf-ready="serviceVariables.generatedPDF">
            </emailer>
            <button class="btn btn-default" type="button" ng-click="showInvoiceModal('postedDebitNote')">Posted Debit Note</button>

            <button class="btn btn-default" type="button" ng-click="NavigateOrder(rec)">Navigate</button>

            <button class="btn btn-submit pic_block" type="button" ng-click="saveDebitNoteInvoice(rec)" ng-show="check_pi_readonly">
                <i class="fa fa-check fa_display"></i> Save
            </button>

            <button class="btn btn-edit" type="button" ng-click="showInvoiceEditForm(1)" ng-if="allowedit_prucase_order" ng-show="!check_pi_readonly">
                <i class="fa fa-edit fa_display"></i> Edit
            </button>

            <button class="btn btn-cancel" type="button" ui-sref="app.purchase-return-invoice">
                <i class="fa fa-undo fa_display"></i>Cancel
            </button>
        </div>
    </div>
</div>