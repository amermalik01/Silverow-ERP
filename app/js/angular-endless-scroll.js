!function(){"use strict";angular.module("dc.endlessScroll",[])}(),function(){"use strict";angular.module("dc.endlessScroll").directive("endlessScroll",function(t,i){function s(t,s){var e,n=0;return function(){var o=(new Date).getTime(),r=s-(o-n),h=arguments;0>=r?(e&&i.cancel(e),e=void 0,n=o,t.apply(this,h)):e||(e=i(function(){e=void 0,n=(new Date).getTime(),t.apply(this,h)},r))}}function e(t){var i=t.match(r);return{item:i[1],collection:i[2],trackBy:i[3]}}function n(i,s,n){var o={scrollOffset:-100,scrollThrottle:300};this.scope=i,this.attrs=n,this.element=$(s),this.options=angular.extend({},o,this.scope.$eval(this.attrs.endlessScrollOptions)),this.docWindow=$(t),this.window=this.options.window?$(this.options.window):this.docWindow,this.dimension={window:{},parent:{},items:[]},this.status={},this.expression=e(this.attrs.endlessScroll),this._watch()}function o(t,i){this.html=this._create(t,i)}var r=/^\s*(.+)\s+in\s+([\r\n\s\S]*?)\s*(\s+track\s+by\s+(.+)\s*)?$/;return n.prototype.check=function(){angular.extend(this.status,this._getScrollStatus()),this.dimension.window=this._getDimension("window"),this.dimension.parent=this._getDimension("parent"),this.clean(),this.status.isEndReached&&this.status.isScrollingDown&&this.dimension.parent.bottom+this.options.scrollOffset<=this.dimension.window.bottom&&this.next(),this.status.isStartReached&&this.status.isScrollingUp&&this.dimension.parent.top-this.options.scrollOffset>=this.dimension.window.top&&this.previous()},n.prototype.next=function(){this.status.isPendingNext||(this._setPending("next",!0),this.scope.$emit("endlessScroll:next",this))},n.prototype.previous=function(){this.status.isPendingPrevious||(this._setPending("previous",!0),this.scope.$emit("endlessScroll:previous",this))},n.prototype.update=function(t){var s,e,n,o,r,h,a;if(r=this.previousOriginalItems,this.originalItems=t,angular.isArray(t)&&angular.isArray(r)){for(h=0,a=t.length;a>h;h++)if(t[h]===r[0]&&void 0!==t[h]){n=h;break}for(h=t.length-1;h>=0;h--)if(t[h]===r[r.length-1]&&void 0!==t[h]){o=h;break}n&&(s=t.slice(0,n)),o&&(e=t.slice(o+1))}angular.isArray(this.items)&&0!==this.items.length?(s&&this.items.unshift.apply(this.items,s),e&&this.items.push.apply(this.items,e)):angular.isArray(t)&&(this.items=t.slice()),angular.isArray(t)&&(this.previousOriginalItems=t.slice()),i(angular.bind(this,function(){this._setPending("next",!1),this._setPending("previous",!1),angular.isArray(t)&&angular.isArray(r)&&this.check()}))},n.prototype.clean=function(){var t,i,s,e,n,o,r,h=this._getParent();s={visibility:"hidden",padding:0,border:0},this.dimension.items=this._getDimension("items"),this.dimension.items&&this.originalItems&&this.dimension.items.length===this.originalItems.length&&(r=this._getChildren(),n=r.get(0)&&r.prop("tagName").toLowerCase(),angular.forEach(this.dimension.items,function(s,e){var n=s.bottom>=this.dimension.window.top-this.dimension.window.height&&s.top<=this.dimension.window.bottom+this.dimension.window.height;n&&(void 0===t&&(t=e),i=e)},this),!this.placeholder&&n&&(this.placeholder=$("<"+n+">"),this.placeholder.css(s).prependTo(h)),this.placeholder&&(e=angular.isDefined(t)?this.dimension.items[t].top-this.dimension.parent.top:0,this.placeholder.height(e)),angular.isDefined(t)&&angular.isDefined(i)&&angular.isArray(this.items)&&angular.isArray(this.originalItems)&&(o=this.originalItems.slice(t,i+1),this.items.splice.apply(this.items,[0,this.items.length].concat(o))))},n.prototype._watch=function(){var t=this.expression.collection;t&&(this.scope.$watch(t,angular.bind(this,function(t,i){t&&i&&this.items&&(this.items=void 0)})),this.scope.$watchCollection(t,angular.bind(this,function(){this.update.apply(this,arguments)})),this.window.on("scroll",this._boundOnScroll=angular.bind(this,this._onScroll)),this.scope.$on("$destroy",angular.bind(this,this._unwatch)))},n.prototype._unwatch=function(){this._boundOnScroll&&this.window.off("scroll",this._boundOnScroll)},n.prototype._setPending=function(t,s){var e="isPending"+t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();this.status[e]=angular.isUndefined(s)?!0:!!s,this.timeouts=this.timeouts||{},this.status[e]&&(this.timeouts[e]&&(i.cancel(this.timeouts[e]),delete this.timeouts[e]),this.timeouts[e]=i(angular.bind(this,function(){this.status[e]=!1}),5e3))},n.prototype._onScroll=function(){this.scope.$apply(angular.bind(this,function(){this._throttledCheck||(this._throttledCheck=s(angular.bind(this,this.check),this.options.scrollThrottle)),this._throttledCheck()}))},n.prototype._getParent=function(){return this._parent&&this._parent.get(0)||(this._parent=this.element.parent()),this._parent},n.prototype._getOffsetTop=function(i){var s=i.offset();return this.window.get(0)===t?s.top:s.top+this.window.scrollTop()-this.docWindow.scrollTop()},n.prototype._getDimension=function(t){var i,s,e,n=this._getParent();switch(t){case"window":return i=this.window.outerHeight(),s=this.window.scrollTop(),e=s+i,{height:i,top:s,bottom:e};case"parent":return i=n.outerHeight(),s=n.get(0)&&this._getOffsetTop(n),e=s+i,{height:i,top:s,bottom:e};case"items":var o,r=this.dimension.items.slice();return this._getChildren().each(angular.bind(this,function(t,n){n=$(n),i=n.outerHeight(),s=n.get(0)&&this._getOffsetTop(n),e=s+i,o=$.inArray(n.scope()[this.expression.item],this.originalItems),o>-1&&(r[o]={height:i,top:s,bottom:e})})),r}},n.prototype._getScrollStatus=function(){var t=this.window.scrollTop(),i={};return this.dimension.window.top>0?(i.isScrollingUp=t-this.dimension.window.top<0,i.isScrollingDown=t-this.dimension.window.top>0):(i.isScrollingUp=!1,i.isScrollingDown=!0),angular.isArray(this.items)&&angular.isArray(this.originalItems)?(i.isEndReached=this.items[this.items.length-1]===this.originalItems[this.originalItems.length-1],i.isStartReached=this.items[0]===this.originalItems[0]):(i.isEndReached=!0,i.isStartReached=!1),i},n.prototype._getChildren=function(){var t="[ng-repeat]";return this._getParent().children(t)},o.prototype.toString=function(){return this.html},o.prototype._create=function(t,i){var s=Array.prototype.slice.call(t.prop("attributes"),0),n=e(i.endlessScroll),o=n.item+" in _endlessScroll.items"+(n.trackBy?" "+n.trackBy:"");return angular.forEach(s,function(i){t.removeAttr(i.name)}),t.attr("ng-repeat",o),t.prop("outerHTML")},{restrict:"A",scope:!0,replace:!0,template:function(t,i){return new o(t,i).toString()},controller:function(t,i,s){var e=new n(t,i,s);return t._endlessScroll=e,e}}})}();